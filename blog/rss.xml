<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Eduardo Oliveira Blog</title>
        <link>https://eduardojm.github.io/blog</link>
        <description>Eduardo Oliveira Blog</description>
        <lastBuildDate>Sun, 19 May 2024 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>pt-br</language>
        <item>
            <title><![CDATA[HTMX: por que eu uso?]]></title>
            <link>https://eduardojm.github.io/blog/htmx-por-que-eu-uso</link>
            <guid>https://eduardojm.github.io/blog/htmx-por-que-eu-uso</guid>
            <pubDate>Sun, 19 May 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[This is my first post on Docusaurus.]]></description>
            <content:encoded><![CDATA[<p>Nos últimos dias surgiram diversos tweets com opiniões, indicações, ou pedindo textos de referência sobre o uso do HTMX. Optei pelo uso do HTMX em alguns projetos, inclusive em produção, e pela falta de conteúdos mostrando usos reais da biblioteca, decidi começar a escrever. Esse texto, em específico, nasceu de alguns desses questionamentos do twitter.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conteúdos-">Conteúdos <a name="content"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#conte%C3%BAdos-" class="hash-link" aria-label="Link direto para conteúdos-" title="Link direto para conteúdos-">​</a></h2>
<ul>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#content">Conteúdos</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#intro">Introdução</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#o-que-e">O que é o HTMX?</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#context">Contexto e Motivos pela escolha</a>
<ul>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#template-engine">1. Template Engine</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#django-admin">2. Django-Admin</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#auth">3. Autenticação e Permissão</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#features">4. Funcionalidades do Django</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#scope">5. Escopo</a></li>
</ul>
</li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#points">Alguns contrapontos</a></li>
<li><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#end">Quer dizer, então, que agora eu só uso HTMX?</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introdução-">Introdução <a name="intro"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#introdu%C3%A7%C3%A3o-" class="hash-link" aria-label="Link direto para introdução-" title="Link direto para introdução-">​</a></h2>
<p>Esse texto foi inspirado por uma publicação do Mario Souto (<a href="https://x.com/omariosouto" target="_blank" rel="noopener noreferrer">omariosouto</a>) no twitter ao questionar sobre a quantidade de gente indicando HTMX recentemente e se essas pessoas estavam usando HTMX em produção.</p>
<p>O tweet pode ser visto abaixo:</p>
<p><img decoding="async" loading="lazy" alt="Tweet de Mario Souto com o texto: &amp;quot;Todo mundo que fala pro povo usar HTMX tá usando em prod? Ou é só hype coletivo? Eu queria entender as pessoas que categoricamente sugerem algo que nem elas tem experiência.&amp;quot;" src="https://eduardojm.github.io/assets/images/tweet-e86eaccc5b3ef9db26f5ab099f4e5e4a.png" width="558" height="329" class="img_ev3q"></p>
<p>Tenho trabalhado com HTMX (Django + HTMX, pra especificar a stack), inclusive em produção (Veja o texto <a href="https://dev.to/eduardojm/django-htmx-e-react-usando-htmx-para-alem-de-todo-lists-3amo" target="_blank" rel="noopener noreferrer">Django, Htmx e React: usando HTMX para além de TODO-Lists</a>) e resolvi escrever esse texto para elucidar o contexto e os motivos que me levaram a decisão de usá-lo.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="o-que-é-o-htmx-">O que é o HTMX? <a name="o-que-e"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#o-que-%C3%A9-o-htmx-" class="hash-link" aria-label="Link direto para o-que-é-o-htmx-" title="Link direto para o-que-é-o-htmx-">​</a></h2>
<blockquote>
<p>htmx gives you access to AJAX, CSS Transitions, WebSockets and Server Sent Events directly in HTML, using attributes, so you can build modern user interfaces with the simplicity and power of hypertext</p>
<p>Home do <a href="https://htmx.org/" target="_blank" rel="noopener noreferrer">htmx.org</a></p>
</blockquote>
<p>Resumidamente, o HTMX é uma biblioteca JavaScript que permite que você use transições, faça requisições e coisas do tipo utilizando atributos HTML para construir interfaces modernas utilizando HTML (principalmente em servidores que renderizam HTML, como é o caso do Django).</p>
<p><img decoding="async" loading="lazy" alt="meme sobre usar html" src="https://eduardojm.github.io/assets/images/htmx-d694af258f7b0e67b42568aeb49f222b.jpg" width="800" height="847" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="contexto-e-motivos-pela-escolha-">Contexto e Motivos pela escolha <a name="context"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#contexto-e-motivos-pela-escolha-" class="hash-link" aria-label="Link direto para contexto-e-motivos-pela-escolha-" title="Link direto para contexto-e-motivos-pela-escolha-">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-template-engine-">1. Template Engine <a name="template-engine"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#1-template-engine-" class="hash-link" aria-label="Link direto para 1-template-engine-" title="Link direto para 1-template-engine-">​</a></h3>
<p>O Django é, por padrão, um framework que implementa um sistema de templates que devolve HTML para o navegador. Junto com o sistema de templates, existe um sistema de gerenciamento de arquivos estáticos.</p>
<p>Esse primeiro contexto é importante aqui pois ao utilizar a stack Django + HTMX, não é necessário implementar, adaptar ou configurar nenhum sistema de templates.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-django-admin-">2. Django-Admin <a name="django-admin"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#2-django-admin-" class="hash-link" aria-label="Link direto para 2-django-admin-" title="Link direto para 2-django-admin-">​</a></h3>
<p>O <a href="https://docs.djangoproject.com/en/5.0/ref/contrib/admin/" target="_blank" rel="noopener noreferrer">Django-Admin</a> é uma aplicação (ou um módulo, por assim chamar), incluída junto a distribuição django e que fornece uma interface de administração fácil de ser utilizada para gerenciar os <strong>models</strong> criados dentro dos projetos.</p>
<p>A partir do item anterior, já é possível imaginar que o Django-Admin usa, fundamentalmente, templates HTML e renderização server-side (que devolve o HTML).</p>
<p>Em alguns casos, quando há a necessidade de alguma funcionalidade com maior dinamização dentro do django-admin é mais factível e rápido usar uma biblioteca que faça a ponte para o mesmo sistema de templates HTML que utilizar um framework ou biblioteca front-end, como o React.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-autenticação-e-permissão-">3. Autenticação e Permissão <a name="auth"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#3-autentica%C3%A7%C3%A3o-e-permiss%C3%A3o-" class="hash-link" aria-label="Link direto para 3-autenticação-e-permissão-" title="Link direto para 3-autenticação-e-permissão-">​</a></h3>
<p>Assim como o conjunto de utilitários para o painel administrativo, o django traz por padrão um sistema de autenticação e permissões configurável e utilizar o HTMX remove a necessidade de inserir outros tipos de autenticação (como JWT amplamente usada para API's).</p>
<blockquote>
<p>Outro ponto relevante sobre a autenticação e permissão é que ao utilizar o Django-Admin e uma aplicação Django padrão server-side, a autenticação entre ambiente de admin e aplicação é compartilhada de forma simples, já que, na prática, é o mesmo site.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-funcionalidades-do-django-">4. Funcionalidades do Django <a name="features"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#4-funcionalidades-do-django-" class="hash-link" aria-label="Link direto para 4-funcionalidades-do-django-" title="Link direto para 4-funcionalidades-do-django-">​</a></h3>
<p>O Django possui facilitadores como sistema de formulários e widgets que se integram muito bem com a Template Engine e facilitam coisas como validar os dados e, consequentemente, armazenar no banco de dados.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-escopo-">5. Escopo <a name="scope"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#5-escopo-" class="hash-link" aria-label="Link direto para 5-escopo-" title="Link direto para 5-escopo-">​</a></h3>
<p>Tudo o que descrevi acima foi bastante decisivo para a escolha do HTMX, mas, talvez, o que tenha sido mais decisivo foram os escopos das aplicações e funcionalidades onde o HTMX foi utilizado. São escopos onde os formulários são simples, não exigiam muitas manipulações ou validações. Não existem formulários com muita complexidade (por exemplo, um formulário de cadastro de cliente onde você pode adicionar vários dependentes no cadastro, etc.).</p>
<blockquote>
<p>Mesmo que na maioria dos formulários complexos eu considere como falha de decisões, nem sempre essas decisões são dos devs.</p>
</blockquote>
<p>Dados os motivos acima, ter conhecimento do framework de back-end / server-side ao qual se vai trabalhar, aliado ao HTMX, é importante para decidir se os requisitos dos formulários e outras necessidades podem, ou não, se tornar empecilhos.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alguns-contrapontos-">Alguns contrapontos <a name="points"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#alguns-contrapontos-" class="hash-link" aria-label="Link direto para alguns-contrapontos-" title="Link direto para alguns-contrapontos-">​</a></h2>
<p>Nem tudo são flores.</p>
<p>Em algumas situações é difícil fazer o que se quer fazer com a biblioteca, principalmente pela baixa quantidade, atualmente, de conteúdos.</p>
<p>Assim como em framework's front-end, como o react, lidar com redirecionamento de URL's pode ser bastante complexo, por exemplo pra preservar filtros em requisições via HTMX.</p>
<blockquote>
<p>Existem algumas complexidades com que eu preciso lidar que eu, no atual momento, não transfiro essa responsabilidade ao HTMX e, portanto, não irei listá-las aqui.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quer-dizer-então-que-agora-eu-só-uso-htmx-">Quer dizer, então, que agora eu só uso HTMX? <a name="end"></a><a href="https://eduardojm.github.io/blog/htmx-por-que-eu-uso#quer-dizer-ent%C3%A3o-que-agora-eu-s%C3%B3-uso-htmx-" class="hash-link" aria-label="Link direto para quer-dizer-então-que-agora-eu-só-uso-htmx-" title="Link direto para quer-dizer-então-que-agora-eu-só-uso-htmx-">​</a></h2>
<p>Bem, não. Por mais que eu tenha gostado bastante do desenvolvimento com o HTMX integrado ao Django, uso em poucos projetos e, na maioria das vezes, não é a única forma de dinamização das páginas (em alguns casos é preciso utilizar bastante JavaScript Vanilla ou outras bibliotecas como o React).</p>
<p>Além disso, algumas aplicações com as quais trabalho continuam sendo feitas com API's Rest usando JSON e front-end's como SPA's.</p>
<p>Tudo depende da análise dos pontos listados acima e de contextos das necessidades do negócio, se o projeto já está em andamento, se existe time, se é um projeto que farei sozinho como freelancer, dentre outras questões.</p>]]></content:encoded>
            <author>eduardo_y05@outlook.com (Eduardo Oliveira)</author>
            <category>HTMX</category>
            <category>Django</category>
        </item>
        <item>
            <title><![CDATA[Django, Htmx e React: usando HTMX para além de TODO-Lists]]></title>
            <link>https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists</link>
            <guid>https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists</guid>
            <pubDate>Tue, 09 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[This is my first post on Docusaurus.]]></description>
            <content:encoded><![CDATA[<p>Já faz algum tempo que o <strong>HTMX</strong>, que me foi apresentado pelo <a href="https://twitter.com/JeffQuesado" target="_blank" rel="noopener noreferrer">@JeffQuesado</a>, me pareceu uma ideia muito legal para se trabalhar junto com Django, principalmente o <strong>Django-Admin</strong> que já tem uma estrutura fortemente baseada em <em>server-side</em>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conteúdos-">Conteúdos <a name="contents"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#conte%C3%BAdos-" class="hash-link" aria-label="Link direto para conteúdos-" title="Link direto para conteúdos-">​</a></h2>
<ul>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#contents">Conteúdos</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#intro">Introdução</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#context">Contextualização da Plataforma Atual</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#problem">Entendendo o Problema</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#why">Por que HTMX se já usávamos React?</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#tech">Questões técnicas</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#react">Comunicação entre HTMX e React</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#confirm">Confirmação para execução de ações</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#how">Como é que isso ai funciona?</a></li>
<li><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#future">E o futuro?</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introdução-">Introdução <a name="intro"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#introdu%C3%A7%C3%A3o-" class="hash-link" aria-label="Link direto para introdução-" title="Link direto para introdução-">​</a></h2>
<p>Em uma demanda de um dos projetos em que atuo, precisávamos de uma funcionalidade para a qual o uso do <strong>HTMX</strong> se encaixaria perfeitamente e esse texto tem como objetivo levantar questões pelas quais foi decidido o uso do <strong>HTMX</strong> e não de outras ferramentas e elucidar como foram feitas integrações entre <strong>Django</strong>, <strong>HTMX</strong> e <strong>React</strong> para construir ferramentas reais.</p>
<blockquote>
<p>O título é uma inspiração de um <em>tweet</em> que vi, alguns dias atrás, que questionava se alguém estava utilizando o <strong>HTMX</strong> para algo mais além de criar TODO-Lists.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="contextualização-da-plataforma-atual-">Contextualização da Plataforma Atual <a name="context"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#contextualiza%C3%A7%C3%A3o-da-plataforma-atual-" class="hash-link" aria-label="Link direto para contextualização-da-plataforma-atual-" title="Link direto para contextualização-da-plataforma-atual-">​</a></h2>
<p>O back-end do projeto utiliza o <strong>Django</strong> com <strong>Django-Rest-Framework</strong> para servir uma API de integração para um app mobile e, para gerenciamento dos conteúdos, o <strong>Django-Admin</strong> é utilizado.</p>
<p>O django-admin possuí, nas páginas de formulário, uma estrutura parecida com a seguinte: um cabeçalho ocupado toda a largura da página, e logo a baixo uma sidebar e o conteúdo principal, que no caso é um formulário.</p>
<p><img decoding="async" loading="lazy" alt="Cabeçalho ocupando toda a largura da página e logo abaixo uma sidebar e o conteúdo principal, que no caso é um formulário" src="data:image/png;base64,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AINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAAINAACPXTn1v+pw1G9V09727dGteOfLttVKPprHbU8pj/zZr1iy/IGXxjTNTRh3WQpL0xpaKEU3zW7VMe99TyqX2BySMKn09fqNeQUHrZlE/dDuD9bOSRuy1b3joo398uuLrJq3b9+leP2Gud1bHbzTNL2qTtIZpWyXl9M4Jj4v9IYsOj3p3oxDE5EuaFSR67NDQfF2uXhoffYykd+O3G4fmKDj+ipL1CSv4IPXuXopNaR8e1/asF8uDZG9JUpfEcStCC9Xb76K3glQlkrQoqCveSn58f1M1bet9+1SO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nMLCTof3j/9MZvBckZTyuWLDcx6SnrhCqlckJR6fDDhqgb55rO5+VJ9blPG3NZrffdldLyyO3S46+fze4WlNi5L+8k2u/r00sq8kFZanuVRe9Ypiv1NQ5+TEfxOhYL2U8uS/ZeFHq9blFLY4cL9ac9nshCGSFnWIejN2Fh9+snJlszZtD681f7+dxSHz1OljqZrzII26dKnZ6rCTOuig7V9H3cb14oBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIIBBIICRG7q9MPc7r2ansTjqDcCuJdzEOVFvzI7yq92i3gLUcksrbwUx+VFvEbBz6RQEQRBwDAIYFW+xdtsW9ZbsGGVbot4C7FJygqi3YMciEOwg9fKkXS8QYIfiGAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQwCAQw/h+3ne8hoDiP9wAAAABJRU5ErkJggg==" width="800" height="600" class="img_ev3q"></p>
<p>Em alguns formulários, a estrutura e arquitetura de informação dos <em>models</em> demandava um controle de carregamento e de exibição de itens complexo usando <em>lazy-loading</em>. Desse modo, quando o ferramental do <strong>django</strong> e do <strong>django-admin</strong> deixou de suprir as necessidades, parte desses formulários foi construída utilizando aplicações pequenas com <strong>React</strong>.</p>
<p>Essas aplicações <strong>React</strong> que eram carregadas apenas em páginas específicas não demandavam, por exemplo, o uso de <em>routers</em> e coisas do tipo.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="entendendo-o-problema-">Entendendo o Problema <a name="problem"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#entendendo-o-problema-" class="hash-link" aria-label="Link direto para entendendo-o-problema-" title="Link direto para entendendo-o-problema-">​</a></h2>
<p>O painel de administração é utilizado para algo próximo a um CMS (<em>content management system</em>) para um app de idiomas. Durante a criação de algumas "entidades" dentro da plataforma, seria necessário uma ferramenta, em <em>popup</em>, para consultar as "entidades" já cadastradas, pois esse processo atualmente era gerenciado com planilhas externas, aumentando a complexidade no uso do painel.</p>
<p>Essa mesma ferramenta deveria, também, fornecer a opção de clonar entidades para a página em que se estava trabalhando (alternado a entidade paí/chave estrangeira).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="por-que-htmx-se-já-usávamos-react-">Por que HTMX se já usávamos React? <a name="why"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#por-que-htmx-se-j%C3%A1-us%C3%A1vamos-react-" class="hash-link" aria-label="Link direto para por-que-htmx-se-já-usávamos-react-" title="Link direto para por-que-htmx-se-já-usávamos-react-">​</a></h2>
<p>Quando começamos a avaliar a funcionalidade, a primeira discussão foi: será que o <strong>HTMX</strong> se encaixa bem aqui? ou será melhor lidar com <strong>React</strong>?</p>
<p>Um dos principais pontos levados em consideração: a estrutura do <strong>django</strong> e do <strong>django-admin</strong> já trazia uma quantidade enorme de código e funcionalidades que poderiam ser reutilizadas para a exibição, como paginação, etc. na aplicação <strong>react</strong> que roda nessa aplicação não lidava com paginação nem com diversas outras coisas que demandaria muito mais tempo para implementar que utilizando partes dos <em>templates</em> do <strong>django-admin</strong> adaptados.</p>
<p>Como essa funcionalidade não seria, sempre, inserida nas mesmas páginas que o formulário <strong>react</strong>, haveria muito trabalho pra conciliar o uso do <strong>react</strong>, <strong>bundlers</strong>, etc.</p>
<p>Esse conjunto de fatores foram os principais motivantes para a adoção do <strong>HTMX</strong>, que diferente do <strong>react</strong> que teriamos que lidar com <strong>bundler</strong>, só importamos o script onde fosse necessário utilizar as tags do <strong>HTMX</strong>.</p>
<blockquote>
<p>A simplicidade que o <strong>HTMX</strong> trouxe para essa implementação, talvez tivesse sido utilizada no lugar do <strong>react</strong> se a conhecêssemos na época.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="questões-técnicas-">Questões técnicas <a name="tech"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#quest%C3%B5es-t%C3%A9cnicas-" class="hash-link" aria-label="Link direto para questões-técnicas-" title="Link direto para questões-técnicas-">​</a></h2>
<p>Algumas questões que foram foco dos esforços no trabalho com essa funcionalidade serão tratadas nessa seção. Essas questões não foram, necessariamente, complexas ou problemáticas. São apenas pontos aos quais gostaria de comentar.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="comunicação-entre-htmx-e-react-">Comunicação entre HTMX e React <a name="react"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#comunica%C3%A7%C3%A3o-entre-htmx-e-react-" class="hash-link" aria-label="Link direto para comunicação-entre-htmx-e-react-" title="Link direto para comunicação-entre-htmx-e-react-">​</a></h3>
<p>Como comentado, em algum lugar no texto acima, era necessário clonar itens para o formulário atual. Formulário esse, construído em <strong>React</strong>. Assim, ao integrar uma ação para clonar o item, utilizando o <code>hx-post</code>, é necessário que algum <em>trigger</em> seja disparado para que alguma parte da app <strong>React</strong> possa processar.</p>
<blockquote>
<p>Um detalhe, ao qual não vou adentrar aqui, é que esses "links" para ações estão dentro de um formulário, então na chamada para o <code>hx-post</code> todos os campos do formulário também são enviados.</p>
</blockquote>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">span</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">hx-post</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">/admin/my-action</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">hx-trigger</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">confirmed</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">hx-indicator</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">.htmx-indicator</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">title</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">Clonar</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">span</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>O <code>hx-trigger="confirmed"</code> se deve a seção abaixo, onde tratamos sobre a confirmação para a execução da ação. Fora isso, no lado do servidor, utilizando <code>django-htmx</code> podemos inserir uma header <code>HX-Trigger</code> para disparar um <em>trigger</em> quando a ação do <strong>HTMX</strong> for finalizada:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response </span><span class="token operator">=</span><span class="token plain"> render</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'my_template.html'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> my_context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    resp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'HX-Trigger'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'completeClone'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> resp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dentro do cliente <strong>react</strong> podemos adicionar o evento ao <code>document</code> devido ao event bubbling:</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">useEffect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(80, 250, 123)">fetch</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token dom variable" style="color:rgb(189, 147, 249);font-style:italic">document</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">addEventListener</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'completeClone'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> fetch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token dom variable" style="color:rgb(189, 147, 249);font-style:italic">document</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">removeEventListener</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'completeClone'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> fetch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="confirmação-para-execução-de-ações-">Confirmação para execução de ações <a name="confirm"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#confirma%C3%A7%C3%A3o-para-execu%C3%A7%C3%A3o-de-a%C3%A7%C3%B5es-" class="hash-link" aria-label="Link direto para confirmação-para-execução-de-ações-" title="Link direto para confirmação-para-execução-de-ações-">​</a></h3>
<p>Para exibir confirmações de execução das ações, utilizamos a biblioteca SweetAlert2, que já estava no projeto pra ser utilizada em alguns outros momentos:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">confirmClone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> title</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  text </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'Deseja clonar o item &lt;strong&gt;"'</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    title </span><span class="token operator">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'"&lt;/strong&gt;? Essa ação não poderá ser desfeita!'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token maybe-class-name">Swal</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">fire</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Tem certeza?'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">html</span><span class="token operator">:</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">showCancelButton</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">confirmButtonText</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Sim, Clonar'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token literal-property property">cancelButtonText</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'Cancelar'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">then</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">isConfirmed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    htmx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">trigger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'confirmed'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A linha <code>htmx.trigger(element, 'confirmed');</code> dispara o <em>trigger</em> que está no <code>hx-trigger="confirmed"</code> do <code>span</code>. Aqui é preciso completar, também, a tag:</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">span</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">hx-post</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">/admin/my-action</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">hx-trigger</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">confirmed</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">hx-indicator</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">.htmx-indicator</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag special-attr attr-name" style="color:rgb(241, 250, 140)">onclick</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag special-attr attr-value value javascript language-javascript function" style="color:rgb(80, 250, 123)">confirmClone</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token tag special-attr attr-value value javascript language-javascript keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token tag special-attr attr-value value javascript language-javascript" style="color:rgb(255, 121, 198)"> </span><span class="token tag special-attr attr-value value javascript language-javascript string" style="color:rgb(255, 121, 198)">'título do item!!!!'</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token tag special-attr attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">title</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">Clonar</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">span</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="como-é-que-isso-ai-funciona-">Como é que isso ai funciona? <a name="how"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#como-%C3%A9-que-isso-ai-funciona-" class="hash-link" aria-label="Link direto para como-é-que-isso-ai-funciona-" title="Link direto para como-é-que-isso-ai-funciona-">​</a></h3>
<p>A implementação com <strong>HTMX</strong> fluiu muito bem, mas em diversos momentos foi necessária muita experimentação por falta de clareza do que, exatamente, os comandos fazem ou como lidar para que eles fizessem exatamente o que queria.</p>
<p>Mas, esse pode ser uma <em>skill issue</em> do prazo e de ser a primeira vez utilizando a documentação, tanto que as duas seções acima foram fortemente baseadas pelos seus exemplos (mas não pela sua documentação).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="e-o-futuro-">E o futuro? <a name="future"></a><a href="https://eduardojm.github.io/blog/django-htmx-react-alem-de-todo-lists#e-o-futuro-" class="hash-link" aria-label="Link direto para e-o-futuro-" title="Link direto para e-o-futuro-">​</a></h2>
<p>Bom, desenvolver uma funcionalidade real com <strong>HTMX</strong> foi uma experiência muito boa e creio que o projeto tem muito potêncial, apesar que em diversos momentos, a depender da estrutura e do tamanho do projeto, eu continue achando que uma API (Rest ou <em>intent based</em>) com um cliente front-end ainda seja mais simples de se manipular.</p>
<p>Ainda assim, espero ter mais chances de usar o <strong>HTMX</strong> integrado ao <strong>django-admin</strong> que é, fundamentalmente, <strong>server-side</strong>.</p>]]></content:encoded>
            <author>eduardo_y05@outlook.com (Eduardo Oliveira)</author>
            <category>Django</category>
            <category>HTMX</category>
            <category>React</category>
        </item>
        <item>
            <title><![CDATA[Full-Text Search: Criando um Back-End de Filtro para o Django Rest-Framework]]></title>
            <link>https://eduardojm.github.io/blog/full-text-search-drf-postgres-django</link>
            <guid>https://eduardojm.github.io/blog/full-text-search-drf-postgres-django</guid>
            <pubDate>Sat, 22 Apr 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[This is my first post on Docusaurus.]]></description>
            <content:encoded><![CDATA[<p>O texto <code>Full-Text Search: Implementando com Postgres e Django</code> [1] comenta sobre a implementação do sistema de <em>Full-Text Search</em> do <strong>Postgres</strong>, trazido pelo Leandro Proença no texto <code>A powerful full-text search in PostgreSQL in less than 20 lines</code> [2], utilizando o <strong>django</strong>.</p>
<p>O projeto está no GitHub [3] e, para complementá-lo, esse texto tem por objetivo, construir um back-end de filtro, i.e. um <em>adapter</em> de filtro, para lidar com o <em>full-text search</em>, como no algoritmo do texto anterior dentro do <em>rest-framework</em>.</p>
<p>Pra poder adicionar esse suporte, da melhor forma possível, podemos criar um <em>filter back-end</em> customizado. São utilizados, como referência, o <code>SearchFilter</code> original do <strong>django</strong> [4] e [5].</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mostre-me-o-código">Mostre-me o código<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#mostre-me-o-c%C3%B3digo" class="hash-link" aria-label="Link direto para Mostre-me o código" title="Link direto para Mostre-me o código">​</a></h2>
<p>O código desenvolvido nesse texto está disponível no repositório <a href="https://github.com/EduardoJM/django-full-text-search" target="_blank" rel="noopener noreferrer">django-full-text-search</a> no Github.</p>
<blockquote>
<p>Disclaimer:</p>
<p>O código da versão desse texto está disponível na branch <a href="https://github.com/EduardoJM/django-full-text-search/tree/texto-2" target="_blank" rel="noopener noreferrer">texto-2</a>.</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementando-o-basefilterbackend">Implementando o BaseFilterBackend<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#implementando-o-basefilterbackend" class="hash-link" aria-label="Link direto para Implementando o BaseFilterBackend" title="Link direto para Implementando o BaseFilterBackend">​</a></h2>
<p>Para criar o back-end de filtro, é preciso implementar a classe <code>rest_framework.filters.BaseFilterBackend</code>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> rest_framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">filters </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> BaseFilterBackend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">FullTextSearchFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">BaseFilterBackend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="obtendo-os-parâmetros">Obtendo os parâmetros<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#obtendo-os-par%C3%A2metros" class="hash-link" aria-label="Link direto para Obtendo os parâmetros" title="Link direto para Obtendo os parâmetros">​</a></h3>
<p>Os primeiros métodos que serão implementados na classe acima são apenas métodos que buscam atributos na requisição, como o parâmetro <code>?search</code>, ou no <code>ModelViewSet</code> como, por exemplo, o <code>search_fields</code>. Esse código é bem parecido com o da referência em [5]:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> rest_framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">filters </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> BaseFilterBackend</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> rest_framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">settings </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> api_settings</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">FullTextSearchFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">BaseFilterBackend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_param </span><span class="token operator">=</span><span class="token plain"> api_settings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">SEARCH_PARAM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"search_config"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"search_fields"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_similarity_threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"similarity_threshold"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        params </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search_param</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">''</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        params </span><span class="token operator">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'\x00'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">''</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># strip null characters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        params </span><span class="token operator">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">','</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">' '</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> params</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fazendo-a-busca">Fazendo a Busca<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#fazendo-a-busca" class="hash-link" aria-label="Link direto para Fazendo a Busca" title="Link direto para Fazendo a Busca">​</a></h3>
<p>O método mais importante dessa classe é, sem dúvidas, o <code>filter_queryset</code> que é o método que faz as alterações em um <code>queryset</code> para devolver a resposta da API.</p>
<p>É preciso, antes de tudo, obter os parâmetros para fazer nossa busca, por meio dos métodos implementados acima:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">filter_queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_fields </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_term </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    config </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    threshold </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_similarity_threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Um primeiro ponto, que deve ser levado em consideração, é que, caso a variável <code>search_fields</code> ou a <code>search_term</code> não esteja preenchida, podemos retornar o <code>queryset</code> sem fazer alteração:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">filter_queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> search_term </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> queryset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>O restante do método é bem parecido com o que já implementamos no texto anterior:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">filter_queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_vector </span><span class="token operator">=</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_query </span><span class="token operator">=</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    queryset </span><span class="token operator">=</span><span class="token plain"> queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        search</span><span class="token operator">=</span><span class="token plain">search_vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rank</span><span class="token operator">=</span><span class="token plain">SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            search_vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            search_query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        similarity</span><span class="token operator">=</span><span class="token plain">TrigramSimilarity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">search</span><span class="token operator">=</span><span class="token plain">search_query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">similarity__gt</span><span class="token operator">=</span><span class="token plain">threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-rank"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-similarity"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> queryset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Faz-se importante denotar que o <code>search_fields</code> aqui é usado como <code>*search_fields</code> para "desconstruir" o array. Assim, se <code>search_fields = ["name", "description"]</code>, a criação da instância <code>SearchVector</code> seria feita como <code>SearchVector("name", "description", config=config)</code>.</p>
<p>Por fim, a classe, completa, será:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">FullTextSearchFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">BaseFilterBackend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_param </span><span class="token operator">=</span><span class="token plain"> api_settings</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">SEARCH_PARAM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"search_config"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"search_fields"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_similarity_threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">getattr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"similarity_threshold"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">get_search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        params </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query_params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search_param</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">''</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        params </span><span class="token operator">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'\x00'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">''</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># strip null characters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        params </span><span class="token operator">=</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">','</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">' '</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> params</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">filter_queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        search_fields </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        search_term </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        config </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        threshold </span><span class="token operator">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get_similarity_threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">view</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> search_term </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">or</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> queryset</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        search_vector </span><span class="token operator">=</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        search_query </span><span class="token operator">=</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        queryset </span><span class="token operator">=</span><span class="token plain"> queryset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            search</span><span class="token operator">=</span><span class="token plain">search_vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rank</span><span class="token operator">=</span><span class="token plain">SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                search_vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                search_query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            similarity</span><span class="token operator">=</span><span class="token plain">TrigramSimilarity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">search_fields</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> search_term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">search</span><span class="token operator">=</span><span class="token plain">search_query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">similarity__gt</span><span class="token operator">=</span><span class="token plain">threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-rank"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-similarity"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> queryset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usando-o-fulltextsearchfilter">Usando o FullTextSearchFilter<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#usando-o-fulltextsearchfilter" class="hash-link" aria-label="Link direto para Usando o FullTextSearchFilter" title="Link direto para Usando o FullTextSearchFilter">​</a></h2>
<p>A classe <code>FullTextSearchFilter</code> pode ser utilizada nos <code>filter_backends</code> dos <code>ModelViewSet</code> do <em>django-rest-framework</em>. Simplificando:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> rest_framework </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> serializers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> rest_framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">viewsets </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> ModelViewSet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> texto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">models </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Singer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">filters </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> FullTextSearchFilter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SingerSerializer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">serializers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ModelSerializer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Meta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        model </span><span class="token operator">=</span><span class="token plain"> Singer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fields </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"__all__"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SingerViewSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ModelViewSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    queryset </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    serializer_class </span><span class="token operator">=</span><span class="token plain"> SingerSerializer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    filter_backends </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">FullTextSearchFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_config </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_fields </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ao registrar o <code>SingerViewSet</code> nas <code>urls</code> do projeto já é possível fazer chamadas para o <em>endpoint</em> utilizando o <code>?search</code> como <em>full-text search</em>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">urls </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> include</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> rest_framework</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">routers </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SimpleRouter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">viewsets </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SingerViewSet</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">router </span><span class="token operator">=</span><span class="token plain"> SimpleRouter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">router</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">register</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"singer"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SingerViewSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Singer"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">urlpatterns </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'api/'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> include</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">router</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">urls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Exemplo de chamada para a API com ?search=Marrone e mostrando os resultados filtrados e ordenados de modo correto" src="https://eduardojm.github.io/assets/images/full_text_5-a3a32da72ef4d61b1522063e8f44224d.png" width="684" height="627" class="img_ev3q"></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mostrando-o-rank-e-similarity-no-retorno-da-api">Mostrando o Rank e Similarity no retorno da API<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#mostrando-o-rank-e-similarity-no-retorno-da-api" class="hash-link" aria-label="Link direto para Mostrando o Rank e Similarity no retorno da API" title="Link direto para Mostrando o Rank e Similarity no retorno da API">​</a></h2>
<p>É possível, inclusive, exibir os dados de <code>rank</code> e <code>similarity</code> no retorno da API. Como esses dados estão sendo anotados, i.e. acrescentados, na entidade, é possível, apenas, alterar o <code>ModelSerializer</code>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SingerSerializer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">serializers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ModelSerializer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rank </span><span class="token operator">=</span><span class="token plain"> serializers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">FloatField</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">read_only</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    similarity </span><span class="token operator">=</span><span class="token plain"> serializers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">FloatField</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">read_only</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Meta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        model </span><span class="token operator">=</span><span class="token plain"> Singer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fields </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"__all__"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Exemplo de chamada para a API com ?search=Marrone e mostrando os resultados com os campos rank e similarity sendo exibidos" src="https://eduardojm.github.io/assets/images/full_text_6-eaf2b60fefa698f0bdfb932a668df2ae.png" width="504" height="618" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mas-e-sem-a-busca">Mas, e sem a busca?<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#mas-e-sem-a-busca" class="hash-link" aria-label="Link direto para Mas, e sem a busca?" title="Link direto para Mas, e sem a busca?">​</a></h3>
<p>Acrescentar, apenas, o <code>rank</code> e <code>similarity</code> no <code>ModelSerializer</code> traz um problema: quando o <em>endpoint</em> é chamado sem o <code>?search</code> os dados de <code>rank</code> e <code>similarity</code> não são retornados:</p>
<p><img decoding="async" loading="lazy" alt="Exemplo de retorno da API sem utilizar o parâmetro ?search na URL e que os itens são retornados sem o campo rank e similarity" src="https://eduardojm.github.io/assets/images/full_text_7-83d652c002acc961e946249dc4341090.png" width="439" height="620" class="img_ev3q"></p>
<p>Isso pode ser resolvido, acrescentando, no construtor do FloatField, o parâmetro <code>default=0</code>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SingerSerializer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">serializers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ModelSerializer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rank </span><span class="token operator">=</span><span class="token plain"> serializers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">FloatField</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">read_only</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> default</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    similarity </span><span class="token operator">=</span><span class="token plain"> serializers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">FloatField</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">read_only</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> default</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Meta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        model </span><span class="token operator">=</span><span class="token plain"> Singer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fields </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"__all__"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="filtrando-por-similaridade">Filtrando por Similaridade<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#filtrando-por-similaridade" class="hash-link" aria-label="Link direto para Filtrando por Similaridade" title="Link direto para Filtrando por Similaridade">​</a></h2>
<p>Por fim, para filtrar por similaridade, é possível definir a variável <code>similarity_threshold</code> no <code>ModelViewSet</code>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">SingerViewSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ModelViewSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    queryset </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    serializer_class </span><span class="token operator">=</span><span class="token plain"> SingerSerializer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    filter_backends </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">FullTextSearchFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_config </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search_fields </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    similarity_threshold </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0.3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Exemplo de chamada para a API com ?search=Bruninho exibindo apenas os itens com o campo &amp;quot;similarity&amp;quot; maior que 0.3" src="https://eduardojm.github.io/assets/images/full_text_8-067e867c028e3bafbcd4f535f290780b.png" width="469" height="512" class="img_ev3q"></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="referências">Referências<a href="https://eduardojm.github.io/blog/full-text-search-drf-postgres-django#refer%C3%AAncias" class="hash-link" aria-label="Link direto para Referências" title="Link direto para Referências">​</a></h2>
<p>[1] <a href="https://dev.to/eduardojm/full-text-search-implementando-com-postgres-e-django-kmf" target="_blank" rel="noopener noreferrer">Full-Text Search: Implementando com Postgres e Django</a></p>
<p>[2] <a href="https://leandronsp.com/a-powerful-full-text-search-in-postgresql-in-less-than-20-lines" target="_blank" rel="noopener noreferrer">A powerful full-text search in PostgreSQL in less than 20 lines</a></p>
<p>[3] <a href="https://github.com/EduardoJM/django-full-text-search" target="_blank" rel="noopener noreferrer">django-full-text-search</a></p>
<p>[4] <a href="https://www.django-rest-framework.org/api-guide/filtering/#searchfilter" target="_blank" rel="noopener noreferrer">Filtering - SearchFilter</a></p>
<p>[5] <a href="https://github.com/encode/django-rest-framework/blob/master/rest_framework/filters.py#L39" target="_blank" rel="noopener noreferrer">rest_framework/filters.py</a></p>
<hr>
<p><a href="https://unsplash.com/pt-br/fotografias/ehyV_XOZ4iA" target="_blank" rel="noopener noreferrer">Foto de Capa por Douglas Lopes no Unsplash</a></p>]]></content:encoded>
            <author>eduardo_y05@outlook.com (Eduardo Oliveira)</author>
            <category>Django</category>
            <category>PostgreSQL</category>
            <category>Full-Text Search</category>
        </item>
        <item>
            <title><![CDATA[Full-Text Search: Implementando com Postgres e Django]]></title>
            <link>https://eduardojm.github.io/blog/full-text-search-postgres-django</link>
            <guid>https://eduardojm.github.io/blog/full-text-search-postgres-django</guid>
            <pubDate>Mon, 10 Apr 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[This is my first post on Docusaurus.]]></description>
            <content:encoded><![CDATA[<p>Algum tempo atrás vi o texto "A powerful full-text search in PostgreSQL in less than 20 lines" do Leandro Proença [1] e quis implementar algo assim pra projetos que não demandam o poder de um Apache Lucene ou de um Elastic Search.</p>
<p>O django já possui, em seu <em>core</em>, uma aplicação com métodos que são utilizados apenas com o <strong>Postgres</strong> e, para a minha surpresa, todos os conceitos de <em>full-text search</em> já estavam disponíveis nesse <em>app</em>.</p>
<p>Restou, nesse caso, tentar reproduzir, por assim dizer, a <em>query</em> do texto original utilizando o <strong>ORM</strong> do django e os métodos do <em>full-text search</em>.</p>
<p>Esse texto tem, por objetivo, trazer explicações sobre como essa implementação foi feita. Fundamentalmente, esse texto será uma versão explicada <a href="https://twitter.com/goticodocalypso/status/1645248408066613248" target="_blank" rel="noopener noreferrer">dessa thread no twitter</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mostre-me-o-código">Mostre-me o código<a href="https://eduardojm.github.io/blog/full-text-search-postgres-django#mostre-me-o-c%C3%B3digo" class="hash-link" aria-label="Link direto para Mostre-me o código" title="Link direto para Mostre-me o código">​</a></h2>
<p>Todo o código-fonte do projeto está disponível no GitHub, <a href="https://github.com/EduardoJM/django-full-text-search" target="_blank" rel="noopener noreferrer">nesse repositório</a>.</p>
<blockquote>
<p>Disclaimer:</p>
<p>O código da versão desse texto está disponível na branch <a href="https://github.com/EduardoJM/django-full-text-search/tree/texto-1" target="_blank" rel="noopener noreferrer">texto-1</a>.</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="adicionando-configurações-necessárias">Adicionando configurações necessárias<a href="https://eduardojm.github.io/blog/full-text-search-postgres-django#adicionando-configura%C3%A7%C3%B5es-necess%C3%A1rias" class="hash-link" aria-label="Link direto para Adicionando configurações necessárias" title="Link direto para Adicionando configurações necessárias">​</a></h2>
<p>Dentro do <code>settings.py</code> do projeto, precisamos adicionar a aplicação <code>django.contrib.postgres</code> dentro da variável de <code>INSTALLED_APPS</code> para que possamos utilizar as ferramentas do <strong>django</strong> próprias para o <strong>Postgres</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSTALLED_APPS </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'django.contrib.admin'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'django.contrib.auth'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'django.contrib.contenttypes'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'django.contrib.sessions'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'django.contrib.messages'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'django.contrib.staticfiles'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">'django.contrib.postgres'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="criando-o-model">Criando o model<a href="https://eduardojm.github.io/blog/full-text-search-postgres-django#criando-o-model" class="hash-link" aria-label="Link direto para Criando o model" title="Link direto para Criando o model">​</a></h2>
<p>Precisamos criar um <em>model</em> para poder utilizar os conceitos da busca dentro dele. Para simplificar, esse caso, utilizamos um <em>model</em> com um único campo de texto para as buscas:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">models</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name </span><span class="token operator">=</span><span class="token plain"> models</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">CharField</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Cantor"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> max_length</span><span class="token operator">=</span><span class="token number">150</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__str__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Meta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        verbose_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Cantor"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        verbose_name_plural </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Cantores"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="criando-uma-view">Criando uma view<a href="https://eduardojm.github.io/blog/full-text-search-postgres-django#criando-uma-view" class="hash-link" aria-label="Link direto para Criando uma view" title="Link direto para Criando uma view">​</a></h2>
<p>Para testar os conceitos de <em>full-text search</em>, podemos criar uma <em>view</em>. Antes, é necessário dizer que nesse texto estou usando <em>views</em> padrão do <strong>django</strong> com <em>templates</em> em HTML para não adicionar mais complexidade lidando com o <em>Rest Framework</em>.</p>
<p>Podemos criar uma <em>view</em> que recebe uma <em>query string</em> para fazer a busca:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">shortcuts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> render</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">models </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Singer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">search_singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    term </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">GET</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'q'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># TODO: fazer busca aqui</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-id"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">'singers'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> singers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">'term'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> render</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"cantor.html"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>O <em>template</em> <code>cantor.html</code> que estou utilizando é bem simples apenas para permitir testes de forma mais fácil:</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token doctype punctuation" style="color:rgb(248, 248, 242)">&lt;!</span><span class="token doctype doctype-tag">DOCTYPE</span><span class="token doctype"> </span><span class="token doctype name">html</span><span class="token doctype punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">html</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">en</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">head</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">meta</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">UTF-8</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">meta</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">X-UA-Compatible</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">content</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">IE=edge</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">meta</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">viewport</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">content</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">width=device-width, initial-scale=1.0</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">title</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Buscando Cantores</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">title</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">head</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">body</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">form</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">action</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">input</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">q</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">{%</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">if</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">term</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">%}</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">{{ term }}</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">{%</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">endif</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">%}</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">button</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">submit</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">"</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Pesquisar</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">button</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">form</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {% if singers %}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">main</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {% for item in singers %}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">h3</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">{{item.name}}</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">h3</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {% if item.rank or item.similarity %}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Rank: {{item.rank}}, Similaridade: {{item.similarity}}</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {% endif %}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      {% endfor %}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">main</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {% endif %}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">body</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">html</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="full-text-search">Full-Text Search<a href="https://eduardojm.github.io/blog/full-text-search-postgres-django#full-text-search" class="hash-link" aria-label="Link direto para Full-Text Search" title="Link direto para Full-Text Search">​</a></h2>
<p>Precisamos, primeiro, criar um <strong>SearchVector</strong> (<em>ts_vector</em>) e um <strong>SearchQuery</strong> (<em>tsquery</em>). Assim:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchQuery</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vector </span><span class="token operator">=</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">query </span><span class="token operator">=</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>O vector é feito assim pra utilizar a coluna "name" do model <strong>Singer</strong>. A query é feita para processar a variável <em>term</em> recebida no código da <em>view</em> acima.</p>
<p>O próximo ponto é criar <em>annotations</em> para fazer o <em>select</em> de campos como o <em>to_tsvector</em> e o <em>ts_rank</em> (o método <code>.annotate</code> do <em>Django ORM</em> faz o <em>select</em> de outros campos e agrega eles a entidade):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchRank</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vector </span><span class="token operator">=</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">query </span><span class="token operator">=</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search</span><span class="token operator">=</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rank</span><span class="token operator">=</span><span class="token plain">SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search</span><span class="token operator">=</span><span class="token plain">query</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-rank"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Adicionando o código dentro da view, passamos a ter:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">shortcuts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> render</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchRank</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">models </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Singer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">search_singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    term </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">GET</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'q'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        vector </span><span class="token operator">=</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        query </span><span class="token operator">=</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            search</span><span class="token operator">=</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rank</span><span class="token operator">=</span><span class="token plain">SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            search</span><span class="token operator">=</span><span class="token plain">query</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-rank"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-id"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">'singers'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> singers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">'term'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> render</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"cantor.html"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Utilizando um pequeno grupo de dados para teste:</p>
<p><img decoding="async" loading="lazy" alt="Dados sem Busca" src="data:image/png;base64,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" width="394" height="528" class="img_ev3q"></p>
<p>Podeos testar e verificar que passamos a ter uma busca funcional:</p>
<p><img decoding="async" loading="lazy" alt="Resultado de Busca" src="data:image/png;base64,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" width="368" height="295" class="img_ev3q"></p>
<p>Porém, ainda temos alguns problemas, pois, por exemplo, na busca por palavras incompletas, perdemos o ranqueamento:</p>
<p><img decoding="async" loading="lazy" alt="Busca incompleta" src="data:image/png;base64,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" width="377" height="133" class="img_ev3q"></p>
<p>Nesse ponto, entra a busca por similaridade que, combinada com o <em>Full-Text Search</em> nos permitirá fazer uma busca mais funcional.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="busca-por-similaridade">Busca por Similaridade<a href="https://eduardojm.github.io/blog/full-text-search-postgres-django#busca-por-similaridade" class="hash-link" aria-label="Link direto para Busca por Similaridade" title="Link direto para Busca por Similaridade">​</a></h2>
<p>Precisamos, primeiro, adicionar a extensão <strong>pg_trgm</strong> no banco de dados. Podemos fazer isso manualmente ou podemos criar uma <em>migration</em> vazia e adicionar essa extensão na <em>migration</em>. Vou seguir pela segunda opção. Para a primeira, basta executar o comando no banco de dados:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> EXTENSION pg_trgm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Para a segunda abordagem, podemos executar o comando <code>python manage.py makemigrations nome_do_app --empty</code> e ele criará uma -<em>migration</em> vazia. A partir da <em>migration</em> vazia, podemos adicionar o import ao CreateExtension e adicionar dentro de operations:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">db </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> migrations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">operations </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> CreateExtension</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Migration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">migrations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Migration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dependencies </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'texto'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'0003_alter_feat_music'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    operations </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CreateExtension</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"pg_trgm"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Basta agora executar <code>python manage.py migrate</code> e teremos a extensão criada no banco de dados.</p>
<p>Agora, dentro da nossa busca, podemos fazer o uso do <strong>TrigramSimilarity</strong> para melhorar nossos resultados. Primeiro, vamos adicionar dentro do <code>.annotate</code>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> TrigramSimilarity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search</span><span class="token operator">=</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rank</span><span class="token operator">=</span><span class="token plain">SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    similarity</span><span class="token operator">=</span><span class="token plain">TrigramSimilarity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Precisamos, também, alterar o <code>.filter</code> para utilizar de um operador lógico <strong>OU</strong>. Para isso, precisamos fazer uso do <code>Q(condição 1) | Q(condição 2)</code> do <strong>django</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> TrigramSimilarity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">models </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Q</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    search</span><span class="token operator">=</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rank</span><span class="token operator">=</span><span class="token plain">SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    similarity</span><span class="token operator">=</span><span class="token plain">TrigramSimilarity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">search</span><span class="token operator">=</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">similarity__gt</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-rank"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-similarity"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Aqui, o que fazemos é adicionar o campo de <em>similarity</em> na nossa <em>query</em> e filtrar pra "o full-text search encontrou" ou "a similaridade é maior que zero". A partir desse momento, fazendo a mesma busca de um dos prints acima:</p>
<p><img decoding="async" loading="lazy" alt="Busca por Similaridade" src="https://eduardojm.github.io/assets/images/full_text_4-f721a399e58b0235f1f012d33b90e6fe.png" width="331" height="285" class="img_ev3q"></p>
<p>Por fim, nossa <em>view</em> passa a ter o código:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">shortcuts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> render</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">models </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Q</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    TrigramSimilarity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">models </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Singer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">search_singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    term </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">GET</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'q'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        vector </span><span class="token operator">=</span><span class="token plain"> SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        query </span><span class="token operator">=</span><span class="token plain"> SearchQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            search</span><span class="token operator">=</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rank</span><span class="token operator">=</span><span class="token plain">SearchRank</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            similarity</span><span class="token operator">=</span><span class="token plain">TrigramSimilarity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">search</span><span class="token operator">=</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> Q</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">similarity__gt</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-rank"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"-similarity"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        singers </span><span class="token operator">=</span><span class="token plain"> Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">objects</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">order_by</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"-id"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    context </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">'singers'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> singers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">'term'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> term</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> render</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"cantor.html"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>É possível utilizar tanto o <em>rank</em> ou o <em>similarity</em> para cortar valores, conforme exemplos da documentação.</p>
<p>Por último, podemos adicionar um índice dentro do nosso <em>model</em> para lidar com performance das queries:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">db </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> models</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">indexes </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> GinIndex</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> django</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">search </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> SearchVector</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Singer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">models</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name </span><span class="token operator">=</span><span class="token plain"> models</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">CharField</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Cantor"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> max_length</span><span class="token operator">=</span><span class="token number">150</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">__str__</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">Meta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        verbose_name </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Cantor"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        verbose_name_plural </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Cantores"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        indexes </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            GinIndex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                SearchVector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> config</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"portuguese"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"singer_search_vector_idx"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar código para a área de transferência" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<p>Todo o código-fonte do projeto está disponível no GitHub, <a href="https://github.com/EduardoJM/django-full-text-search" target="_blank" rel="noopener noreferrer">nesse repositório</a>.</p>
<blockquote>
<p>Disclaimer:</p>
<p>O código da versão desse texto está disponível na branch <a href="https://github.com/EduardoJM/django-full-text-search/tree/texto-1" target="_blank" rel="noopener noreferrer">texto-1</a>.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="referências">Referências<a href="https://eduardojm.github.io/blog/full-text-search-postgres-django#refer%C3%AAncias" class="hash-link" aria-label="Link direto para Referências" title="Link direto para Referências">​</a></h2>
<p>1 - <a href="https://leandronsp.com/a-powerful-full-text-search-in-postgresql-in-less-than-20-lines" target="_blank" rel="noopener noreferrer">A powerful full-text search in PostgreSQL in less than 20 lines
</a></p>
<p>2 - <a href="https://docs.djangoproject.com/en/4.2/ref/contrib/postgres/search/" target="_blank" rel="noopener noreferrer">Full text search - Django Documentation</a></p>
<hr>
<p><a href="https://unsplash.com/pt-br/fotografias/eQ2Z9ay9Wws" target="_blank" rel="noopener noreferrer">Foto de capa por Mick Haupt no Unsplash</a>.</p>]]></content:encoded>
            <author>eduardo_y05@outlook.com (Eduardo Oliveira)</author>
            <category>Django</category>
            <category>PostgreSQL</category>
            <category>Full-Text Search</category>
        </item>
    </channel>
</rss>